<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	<div id="app">
		<div class="box">
			<h2>PC端调取摄像头</h2>
			<div>
		    	<button @click="openVideo">打开摄像头</button>
		    	<button @click="getPhoto">拍照</button>
		    	<button @click="upload">上传</button>
		    	<div>
			      	<video src="" ref="myVideo" :width="width" :height="height"></video>
			    </div>
			    <div>
			     	<canvas ref="myCanvas" :width="width" :height="height"></canvas>
			    </div>
			    <div :style="{wordWrap: 'break-word'}">
			     	<span>
			    		{{ base64Data }}
			     	</span>
			    </div>
			</div>
	  	</div>
	  	<div class="box">
	  		<h2>移动端调取摄像头</h2>
	  		<div>
	  			<button @click="openCamera1">打开后置摄像头</button>
	  			<input ref="mobileCamera1" type="file" capture="camera" accept="image/*"/ style="display:none;" @change="onFileChange">
	  			<button @click="openCamera2">打开前置摄像头</button>
	  			<input ref="mobileCamera2" type="file" capture="user" accept="image/*"/ style="display:none;">
	  			<div>
			     	<canvas ref="myCanvas2" :width="width" :height="height"></canvas>
			    </div>
			    <div>
			     	{{ imgsrc }}
			    </div>
	  		</div>
	  		<div v-if="false">
	  			<button @click="getCamera">用plus方法调用摄像头</button>
	  			<p>{{ mobilePath }}</p>
	  		</div>
	  	</div>
	</div>
</body>
<script src="./js/vue.js" type="text/javascript"></script>
<script>
	var app = new Vue({
		el: '#app',
		data: {
	  		context: null,
	  		context2: null,
	    	width: 300,
	    	height: 200,
	    	base64Data: '',
	    	mobilePath: '',
	    	imgsrc: '',
	    	pcCamera: true
	  	},
	  	computed: {
			myCanvas () {
      			return this.$refs.myCanvas
    		},
    		myCanvas2 () {
      			return this.$refs.myCanvas2
    		},
    		myVideo () {
      			return this.$refs.myVideo
    		}
  		},
  		methods: {
    		openVideo () {
      			if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        			navigator.mediaDevices.getUserMedia({
          				video: true,
          				audio: false // 音频关闭状态
        			}).then((stream) => {
		      			this.myVideo.srcObject = stream
		          		this.myVideo.play()
        			}).catch(err => {
          				console.log('err', err)
        			})
      			}
    		},
			getPhoto () {
  				this.context = this.myCanvas.getContext('2d')
  				this.context.drawImage(this.myVideo, 0, 0, this.width, this.height)
			},
			upload () {
      			this.base64Data = this.myCanvas.toDataURL('image/png')
      			console.log('调接口', this.base64Data)
    		},
    		openCamera1 () {
    			this.$refs.mobileCamera1.click()
    		},
    		openCamera2 () {
    			this.$refs.mobileCamera2.click()
    		},
    		onFileChange (e) {
144         	alert(1)
154         },
    		getCamera (e) {		// 浏览器调试无效，需要搭建APP环境
                var that = this
                plus.camera.getCamera().captureImage(function(e){
                    console.log(e)
                    plus.io.resolveLocalFileSystemURL(e, function(entry) {
                        this.mobilePath = entry.toLocalURL()
                    }, function(e) {
//                        mui.toast("读取拍照文件错误：" + e.message);
                    });

                });
            },
  		}
	})
</script>
<style>
	.box {
		width: 400px;
		float: left;
	}
	button {
		border: none;
		border-radius: 3px;
		background-color: #364fbb;
		color: #fff;
		padding: 5px 10px;
		margin-bottom: 10px;
	}
</style>
</html>